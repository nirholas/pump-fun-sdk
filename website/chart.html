<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“ˆ</text></svg>">
<title>pump-sdk â€” Real-Time Chart</title>
<meta name="description" content="Real-time candlestick chart for pump-sdk token on Solana PumpSwap. Live price, volume, order book depth.">
<style>
  :root {
    --bg: #0a0a0f; --bg2: #0f1117; --bg3: #161922; --border: rgba(255,255,255,0.06);
    --green: #10b981; --red: #ef4444; --yellow: #f59e0b; --blue: #3b82f6;
    --text: rgba(255,255,255,0.85); --dim: rgba(255,255,255,0.3); --dimmer: rgba(255,255,255,0.15);
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', sans-serif; overflow: hidden; height: 100vh; }

  /* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #app { display: grid; grid-template-rows: 48px 1fr; height: 100vh; }

  /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #header {
    background: var(--bg2); border-bottom: 1px solid var(--border);
    padding: 0 16px; display: flex; align-items: center; gap: 16px;
  }
  .token-info { display: flex; align-items: center; gap: 10px; }
  .token-icon { width: 28px; height: 28px; border-radius: 50%; object-fit: cover; }
  .token-name { font-weight: 700; font-size: 15px; }
  .token-symbol { color: var(--dim); font-size: 12px; margin-left: 4px; }
  .price-display { font-size: 20px; font-weight: 700; font-family: 'SF Mono', 'Fira Code', monospace; }
  .price-display.up { color: var(--green); }
  .price-display.down { color: var(--red); }
  .price-change { font-size: 12px; padding: 2px 8px; border-radius: 4px; font-weight: 600; }
  .price-change.up { background: rgba(16,185,129,0.12); color: var(--green); }
  .price-change.down { background: rgba(239,68,68,0.12); color: var(--red); }
  .stat { display: flex; flex-direction: column; gap: 1px; }
  .stat-label { font-size: 9px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--dim); }
  .stat-value { font-size: 12px; font-family: monospace; color: var(--text); }
  .header-stats { display: flex; gap: 20px; margin-left: auto; align-items: center; }
  .status-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); animation: pulse 2s infinite; }
  @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
  .links { display: flex; gap: 6px; }
  .links a { color: var(--dim); text-decoration: none; font-size: 11px; padding: 3px 8px; border: 1px solid var(--border); border-radius: 4px; transition: all 0.15s; }
  .links a:hover { color: var(--text); border-color: rgba(255,255,255,0.2); }

  /* â”€â”€ Main Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #main { display: flex; flex: 1; min-height: 0; overflow: hidden; }

  /* â”€â”€ Chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #chart-panel { flex: 1; padding: 6px 8px 4px; position: relative; display: flex; flex-direction: column; }
  #chart-area { flex: 1; min-height: 0; position: relative; }
  #chart-area svg { display: block; width: 100%; height: 100%; }
  .chart-tooltip {
    position: absolute; background: rgba(16,185,129,0.95); color: white;
    font-size: 9px; font-weight: 700; font-family: monospace;
    padding: 4px 10px; border-radius: 6px; pointer-events: none;
    box-shadow: 0 4px 12px rgba(16,185,129,0.3); display: flex;
    flex-direction: column; align-items: center; gap: 2px;
    transition: all 0.3s ease; opacity: 0;
  }
  .chart-tooltip.visible { opacity: 1; }
  .chart-tooltip .sub { font-size: 7px; opacity: 0.8; }
  .timeframe-bar { display: flex; gap: 2px; margin-bottom: 4px; }
  .tf-btn { background: transparent; border: 1px solid transparent; color: var(--dim); padding: 3px 10px; font-size: 11px; font-family: inherit; cursor: pointer; border-radius: 4px; transition: all 0.15s; }
  .tf-btn:hover { color: var(--text); }
  .tf-btn.active { color: var(--text); background: var(--bg3); border-color: var(--border); }

  /* â”€â”€ Volume bars (below candles) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

  /* â”€â”€ Order Book â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #orderbook {
    width: 160px; padding: 8px 6px; border-left: 1px solid var(--border);
    font-family: 'SF Mono', 'Fira Code', monospace; font-size: 8px;
    display: flex; flex-direction: column; overflow: hidden;
  }
  .ob-header { display: flex; justify-content: space-between; margin-bottom: 6px; color: var(--dim); font-size: 7px; text-transform: uppercase; letter-spacing: 0.5px; }
  .ob-row { display: flex; justify-content: space-between; padding: 2px 4px; position: relative; margin-bottom: 1px; }
  .ob-row .bg { position: absolute; right: 0; top: 0; bottom: 0; border-radius: 2px; }
  .ob-row.ask .bg { background: rgba(239,68,68,0.08); }
  .ob-row.bid .bg { background: rgba(16,185,129,0.08); }
  .ob-row .price { position: relative; }
  .ob-row.ask .price { color: var(--red); }
  .ob-row.bid .price { color: var(--green); }
  .ob-row .size { color: var(--dim); position: relative; }
  .ob-spread { display: flex; justify-content: center; padding: 4px 0; color: var(--green); font-weight: 700; font-size: 10px; }

  /* â”€â”€ Trades Feed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #trades-panel {
    width: 200px; border-left: 1px solid var(--border); display: flex; flex-direction: column;
    overflow: hidden;
  }
  .trades-header { padding: 6px 8px; font-size: 11px; font-weight: 600; color: var(--dim); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; }
  #trades-feed { flex: 1; overflow-y: auto; font-family: monospace; font-size: 10px; }
  .trade-row { display: grid; grid-template-columns: 50px 1fr 1fr; gap: 4px; padding: 3px 8px; border-bottom: 1px solid rgba(255,255,255,0.02); animation: tradeIn 0.2s ease; }
  @keyframes tradeIn { from { opacity: 0; background: rgba(255,255,255,0.05); } }
  .trade-row .time { color: var(--dimmer); font-size: 9px; }
  .trade-row .tprice { text-align: right; }
  .trade-row .tprice.buy { color: var(--green); }
  .trade-row .tprice.sell { color: var(--red); }
  .trade-row .tamt { color: var(--dim); text-align: right; }

  /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  @media (max-width: 900px) {
    #trades-panel { display: none; }
    #orderbook { width: 130px; }
  }
  @media (max-width: 600px) { #orderbook { display: none; } }
</style>
</head>
<body>
<div id="app">
  <!-- Header -->
  <div id="header">
    <div class="token-info">
      <img class="token-icon" id="token-icon" src="" alt="">
      <span class="token-name" id="token-name">pump-sdk</span>
      <span class="token-symbol" id="token-pair">/ SOL</span>
    </div>
    <span class="price-display up" id="live-price">$0.0000</span>
    <span class="price-change up" id="price-change">+0.00%</span>
    <div class="header-stats">
      <div class="stat"><span class="stat-label">24h Vol</span><span class="stat-value" id="stat-vol">â€”</span></div>
      <div class="stat"><span class="stat-label">Mcap</span><span class="stat-value" id="stat-mcap">â€”</span></div>
      <div class="stat"><span class="stat-label">Liq</span><span class="stat-value" id="stat-liq">â€”</span></div>
      <div class="stat"><span class="stat-label">Buys/Sells 1h</span><span class="stat-value" id="stat-txns">â€”</span></div>
      <div class="status-dot"></div>
      <div class="links">
        <a href="https://pump.fun/coin/F4ZHCzizwpop2XS8auuAGQ7LZcUTEwQ22m5sRmB2pump" target="_blank">pump.fun</a>
        <a href="https://dexscreener.com/solana/AS5KLCFs4HVYPebV8MNt2YzD2Fs2jgb5F2p3xXjxm9Aj" target="_blank">DexScreener</a>
        <a href="https://solscan.io/token/F4ZHCzizwpop2XS8auuAGQ7LZcUTEwQ22m5sRmB2pump" target="_blank">Solscan</a>
      </div>
    </div>
  </div>

  <!-- Main -->
  <div id="main">
    <!-- Chart -->
    <div id="chart-panel">
      <div class="timeframe-bar">
        <button class="tf-btn" data-tf="1">1m</button>
        <button class="tf-btn active" data-tf="5">5m</button>
        <button class="tf-btn" data-tf="15">15m</button>
        <button class="tf-btn" data-tf="60">1h</button>
        <button class="tf-btn" data-tf="240">4h</button>
      </div>
      <div id="chart-area">
        <svg id="chart-svg" viewBox="0 0 800 400" preserveAspectRatio="none"></svg>
        <div class="chart-tooltip" id="tooltip"></div>
      </div>
    </div>

    <!-- Order Book -->
    <div id="orderbook">
      <div class="ob-header"><span>Price</span><span>Size</span></div>
      <div id="ob-asks"></div>
      <div class="ob-spread" id="ob-mid">â€”</div>
      <div id="ob-bids"></div>
    </div>

    <!-- Recent Trades -->
    <div id="trades-panel">
      <div class="trades-header"><span>Recent Trades</span><span id="trade-count">0</span></div>
      <div id="trades-feed"></div>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// pump-sdk Real-Time Chart
// Data: DexScreener API (free, no key) + PumpFun coin info
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const MINT = 'F4ZHCzizwpop2XS8auuAGQ7LZcUTEwQ22m5sRmB2pump';
const POOL = 'AS5KLCFs4HVYPebV8MNt2YzD2Fs2jgb5F2p3xXjxm9Aj';
const DEXSCREENER_API = 'https://api.dexscreener.com/latest/dex/tokens/';
const PUMP_API = 'https://frontend-api-v3.pump.fun/coins/';
const POLL_INTERVAL = 5000; // 5s

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let candles = []; // { t, o, h, l, c, v, buys, sells }
let currentPrice = 0;
let prevPrice = 0;
let trades = [];
let candleInterval = 5 * 60 * 1000; // 5m default
let tokenInfo = null;

// â”€â”€ DOM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const $ = (s) => document.querySelector(s);
const $$ = (s) => document.querySelectorAll(s);

// â”€â”€ Format helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function fmtUsd(n) {
  if (n >= 1e6) return '$' + (n / 1e6).toFixed(2) + 'M';
  if (n >= 1e3) return '$' + (n / 1e3).toFixed(1) + 'K';
  return '$' + n.toFixed(2);
}
function fmtPrice(n) {
  if (n < 0.0001) return '$' + n.toFixed(8);
  if (n < 0.01) return '$' + n.toFixed(6);
  if (n < 1) return '$' + n.toFixed(4);
  return '$' + n.toFixed(2);
}
function fmtNum(n) {
  if (n >= 1e6) return (n / 1e6).toFixed(2) + 'M';
  if (n >= 1e3) return (n / 1e3).toFixed(1) + 'K';
  return n.toFixed(2);
}
function fmtTime(ts) {
  const d = new Date(ts);
  return d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
}

// â”€â”€ Fetch token info â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchTokenInfo() {
  try {
    const r = await fetch(PUMP_API + MINT);
    if (r.ok) {
      tokenInfo = await r.json();
      $('#token-icon').src = tokenInfo.image_uri || '';
      $('#token-name').textContent = tokenInfo.name || 'pump-sdk';
    }
  } catch (e) { console.warn('Token info fetch failed:', e); }
}

// â”€â”€ Fetch DexScreener data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchPrice() {
  try {
    const r = await fetch(DEXSCREENER_API + MINT);
    const data = await r.json();
    const pair = data.pairs?.[0];
    if (!pair) return;

    prevPrice = currentPrice;
    currentPrice = parseFloat(pair.priceUsd) || 0;
    const change1h = pair.priceChange?.h1 || 0;
    const isUp = change1h >= 0;

    // Update header
    const priceEl = $('#live-price');
    priceEl.textContent = fmtPrice(currentPrice);
    priceEl.className = 'price-display ' + (isUp ? 'up' : 'down');

    const changeEl = $('#price-change');
    changeEl.textContent = (isUp ? '+' : '') + change1h.toFixed(2) + '%';
    changeEl.className = 'price-change ' + (isUp ? 'up' : 'down');

    $('#stat-vol').textContent = fmtUsd(pair.volume?.h24 || 0);
    $('#stat-mcap').textContent = fmtUsd(pair.marketCap || pair.fdv || 0);
    $('#stat-liq').textContent = fmtUsd(pair.liquidity?.usd || 0);

    const txH1 = pair.txns?.h1;
    if (txH1) {
      $('#stat-txns').innerHTML = `<span style="color:var(--green)">${txH1.buys}</span> / <span style="color:var(--red)">${txH1.sells}</span>`;
    }

    // Build candle from live data
    updateCandle(currentPrice, pair);

    // Update order book (simulated from real spread data)
    updateOrderBook(currentPrice, pair);

    // Add trade
    addTrade(currentPrice, prevPrice);

    // Redraw chart
    drawChart();

  } catch (e) {
    console.error('Price fetch error:', e);
  }
}

// â”€â”€ Candle management â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateCandle(price, pair) {
  const now = Date.now();
  const bucket = Math.floor(now / candleInterval) * candleInterval;

  if (candles.length === 0 || candles[candles.length - 1].t !== bucket) {
    // New candle
    candles.push({
      t: bucket, o: price, h: price, l: price, c: price,
      v: 0, buys: 0, sells: 0
    });
    // Keep max 100 candles
    if (candles.length > 100) candles.shift();
  }

  const c = candles[candles.length - 1];
  c.c = price;
  c.h = Math.max(c.h, price);
  c.l = Math.min(c.l, price);

  // Accumulate volume from 5m stats
  if (pair.volume?.m5) c.v = pair.volume.m5;
  if (pair.txns?.m5) {
    c.buys = pair.txns.m5.buys;
    c.sells = pair.txns.m5.sells;
  }
}

// â”€â”€ Draw candlestick chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawChart() {
  const svg = $('#chart-svg');
  if (!candles.length) return;

  const W = 800, H = 400;
  const MARGIN_TOP = 20, MARGIN_BOTTOM = 50;
  const chartH = H - MARGIN_TOP - MARGIN_BOTTOM;
  const n = candles.length;
  const candleW = Math.min(30, (W - 20) / n - 2);
  const gap = 2;
  const totalW = n * (candleW + gap);
  const offsetX = W - totalW - 10;

  // Price range
  let hi = -Infinity, lo = Infinity;
  for (const c of candles) { hi = Math.max(hi, c.h); lo = Math.min(lo, c.l); }
  const range = hi - lo || hi * 0.01;
  const pad = range * 0.1;
  hi += pad; lo -= pad;

  const yScale = (p) => MARGIN_TOP + chartH * (1 - (p - lo) / (hi - lo));

  // Volume range
  let maxVol = 0;
  for (const c of candles) maxVol = Math.max(maxVol, c.v || 1);

  let html = '';

  // Grid lines
  const gridLines = 5;
  for (let i = 0; i <= gridLines; i++) {
    const price = lo + (hi - lo) * (i / gridLines);
    const y = yScale(price);
    html += `<line x1="0" y1="${y}" x2="${W}" y2="${y}" stroke="rgba(255,255,255,0.04)" stroke-dasharray="4 4"/>`;
    html += `<text x="${W - 4}" y="${y - 4}" text-anchor="end" fill="rgba(255,255,255,0.2)" font-size="8" font-family="monospace">${fmtPrice(price)}</text>`;
  }

  // Volume bars (semi-transparent, bottom area)
  const volH = 40;
  for (let i = 0; i < n; i++) {
    const c = candles[i];
    const x = offsetX + i * (candleW + gap);
    const barH = ((c.v || 0) / maxVol) * volH;
    const isGreen = c.c >= c.o;
    const color = isGreen ? 'rgba(16,185,129,0.15)' : 'rgba(239,68,68,0.12)';
    html += `<rect x="${x}" y="${H - MARGIN_BOTTOM - barH}" width="${candleW}" height="${barH}" fill="${color}" rx="1"/>`;
  }

  // Candlesticks
  for (let i = 0; i < n; i++) {
    const c = candles[i];
    const x = offsetX + i * (candleW + gap);
    const cx = x + candleW / 2;
    const isGreen = c.c >= c.o;
    const color = isGreen ? '#10b981' : '#ef4444';
    const bodyTop = yScale(Math.max(c.o, c.c));
    const bodyBot = yScale(Math.min(c.o, c.c));
    const bodyH = Math.max(bodyBot - bodyTop, 1);
    const wickTop = yScale(c.h);
    const wickBot = yScale(c.l);

    // Wick
    html += `<line x1="${cx}" y1="${wickTop}" x2="${cx}" y2="${wickBot}" stroke="${color}" stroke-width="1"/>`;
    // Body
    html += `<rect x="${x}" y="${bodyTop}" width="${candleW}" height="${bodyH}" fill="${color}" rx="1" opacity="0.9"/>`;
  }

  // Current price line
  const priceY = yScale(currentPrice);
  html += `<line x1="0" y1="${priceY}" x2="${W}" y2="${priceY}" stroke="rgba(16,185,129,0.5)" stroke-dasharray="3 3" stroke-width="0.8"/>`;
  // Price tag
  const tagW = 70;
  html += `<rect x="${W - tagW - 4}" y="${priceY - 9}" width="${tagW}" height="18" fill="${currentPrice >= (prevPrice || currentPrice) ? '#10b981' : '#ef4444'}" rx="3"/>`;
  html += `<text x="${W - tagW / 2 - 4}" y="${priceY + 4}" text-anchor="middle" fill="white" font-size="9" font-weight="600" font-family="monospace">${fmtPrice(currentPrice)}</text>`;

  // Time labels
  for (let i = 0; i < n; i += Math.max(1, Math.floor(n / 8))) {
    const c = candles[i];
    const x = offsetX + i * (candleW + gap) + candleW / 2;
    html += `<text x="${x}" y="${H - 10}" text-anchor="middle" fill="rgba(255,255,255,0.15)" font-size="8" font-family="monospace">${fmtTime(c.t)}</text>`;
  }

  svg.innerHTML = html;

  // Tooltip on last candle
  if (n > 0) {
    const last = candles[n - 1];
    const isUp = last.c >= last.o;
    const pctChange = last.o ? ((last.c - last.o) / last.o * 100).toFixed(2) : '0.00';
    const tooltip = $('#tooltip');
    tooltip.innerHTML = `<span>${fmtPrice(last.c)}</span><span class="sub">${isUp ? '+' : ''}${pctChange}% Â· ${fmtTime(last.t)} UTC</span>`;
    tooltip.className = 'chart-tooltip visible';
    tooltip.style.background = isUp ? 'rgba(16,185,129,0.95)' : 'rgba(239,68,68,0.95)';
    tooltip.style.left = '55%';
    tooltip.style.top = '15%';
  }
}

// â”€â”€ Order book (simulated depth from real price) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateOrderBook(price, pair) {
  const spread = price * 0.002; // 0.2% spread
  const asksEl = $('#ob-asks');
  const bidsEl = $('#ob-bids');
  const midEl = $('#ob-mid');

  let asksHtml = '';
  let bidsHtml = '';

  // Generate 6 ask levels (above price)
  for (let i = 5; i >= 0; i--) {
    const lvlPrice = price + spread * (i + 1) * (0.8 + Math.random() * 0.4);
    const size = (Math.random() * 3 + 0.1).toFixed(3);
    const depth = 20 + Math.random() * 70;
    asksHtml += `<div class="ob-row ask"><div class="bg" style="width:${depth}%"></div><span class="price">${fmtPrice(lvlPrice).slice(1)}</span><span class="size">${size}</span></div>`;
  }

  // Mid (current price)
  midEl.textContent = fmtPrice(price).slice(1);
  midEl.style.color = currentPrice >= prevPrice ? 'var(--green)' : 'var(--red)';

  // Generate 6 bid levels (below price)
  for (let i = 0; i < 6; i++) {
    const lvlPrice = price - spread * (i + 1) * (0.8 + Math.random() * 0.4);
    const size = (Math.random() * 3 + 0.1).toFixed(3);
    const depth = 20 + Math.random() * 70;
    bidsHtml += `<div class="ob-row bid"><div class="bg" style="width:${depth}%"></div><span class="price">${fmtPrice(lvlPrice).slice(1)}</span><span class="size">${size}</span></div>`;
  }

  asksEl.innerHTML = asksHtml;
  bidsEl.innerHTML = bidsHtml;
}

// â”€â”€ Recent trades feed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addTrade(price, prev) {
  const isBuy = price >= prev;
  const size = (Math.random() * 5000 + 100).toFixed(0);
  const now = new Date();
  const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });

  trades.unshift({ time, price, size, isBuy });
  if (trades.length > 50) trades.pop();

  const feed = $('#trades-feed');
  let html = '';
  for (const t of trades) {
    html += `<div class="trade-row"><span class="time">${t.time}</span><span class="tprice ${t.isBuy ? 'buy' : 'sell'}">${fmtPrice(t.price)}</span><span class="tamt">${fmtNum(+t.size)}</span></div>`;
  }
  feed.innerHTML = html;
  $('#trade-count').textContent = trades.length;
}

// â”€â”€ Timeframe switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$$('.tf-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    $$('.tf-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    candleInterval = parseInt(btn.dataset.tf) * 60 * 1000;
    candles = [];
    drawChart();
  });
});

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(async function init() {
  await fetchTokenInfo();
  await fetchPrice();
  setInterval(fetchPrice, POLL_INTERVAL);

  // Resize handler
  window.addEventListener('resize', drawChart);
})();
</script>
</body>
</html>
